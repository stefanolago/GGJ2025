[gd_scene load_steps=52 format=3 uid="uid://dy5b0e8fulwac"]

[ext_resource type="Shader" path="res://game/entities/bubble/shake.gdshader" id="1_3omog"]
[ext_resource type="Script" path="res://utils/state_machine.gd" id="1_aabyq"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble.gd" id="1_udmfy"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/calm.gd" id="2_cmhqn"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/happy.gd" id="3_ql0vy"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/less_happy.gd" id="4_5o5i0"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/worried.gd" id="5_8kdti"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/scared.gd" id="6_8pe0x"]
[ext_resource type="Texture2D" uid="uid://bp5ixf64gyd5d" path="res://assets/art/bubble/bolla-1.png" id="8_cxdc2"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_sprite.gd" id="9_6kqpo"]
[ext_resource type="Texture2D" uid="uid://pl4dms2t7ro0" path="res://assets/art/bubble/bolla-rotta-1.png" id="9_ha83g"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/untouched_state.gd" id="9_u1hra"]
[ext_resource type="Texture2D" uid="uid://bhh2s77l3k2qt" path="res://assets/art/bubble/faccina.png" id="10_00hlv"]
[ext_resource type="Texture2D" uid="uid://bli6npdlqm1jk" path="res://assets/art/bubble/bolla-rotta-2.png" id="10_8hyo1"]
[ext_resource type="Texture2D" uid="uid://dxbs0pqbp6wb3" path="res://assets/art/bubble/bolla-premuta.png" id="11_1jru2"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/popped_state.gd" id="12_0e84d"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/running_away_state.gd" id="12_l4h1j"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/pressed_state.gd" id="13_0pvk2"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/looking_for_companions_state.gd" id="13_36ui5"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/revolting_state.gd" id="14_2j2oh"]
[ext_resource type="Texture2D" uid="uid://bpt52hqpx2gi0" path="res://assets/art/bubble/faccina-morta.png" id="14_5oeb3"]
[ext_resource type="Texture2D" uid="uid://dop65axsyhd48" path="res://assets/art/bubble/faccina-felice.png" id="14_6oneh"]
[ext_resource type="Script" path="res://game/entities/bubble/bubble_states/popping_state.gd" id="14_kxy2l"]
[ext_resource type="Texture2D" uid="uid://bngnb5wt5814t" path="res://assets/art/bubble/faccina-bolla-premuta.png" id="15_pve6u"]
[ext_resource type="Texture2D" uid="uid://dvw6ix2d0f48f" path="res://assets/art/bubble/faccina-spaventata.png" id="16_w77yh"]
[ext_resource type="Texture2D" uid="uid://chk2l7ojoflmb" path="res://assets/art/bubble/faccina-felicissima.png" id="17_q3kfc"]
[ext_resource type="Texture2D" uid="uid://brlevjwmml3eu" path="res://assets/art/bubble/faccina-preoccupata.png" id="18_4iu74"]
[ext_resource type="Texture2D" uid="uid://bpjm3doo7jw1k" path="res://assets/art/bubble/bolla-rotta-3.png" id="19_5eqja"]
[ext_resource type="Texture2D" uid="uid://5l2yx7lixesv" path="res://assets/art/bubble/morso-sprite-sheet.png" id="21_5k6pg"]
[ext_resource type="PackedScene" uid="uid://exfrtkbxge5q" path="res://game/entities/attack_marker.tscn" id="29_og2x4"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_m81it"]
resource_local_to_scene = true
shader = ExtResource("1_3omog")
shader_parameter/amplitude = 20.0
shader_parameter/frequency = 0.0

[sub_resource type="SpriteFrames" id="SpriteFrames_84kn1"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("8_cxdc2")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("9_ha83g")
}, {
"duration": 1.0,
"texture": ExtResource("10_8hyo1")
}, {
"duration": 1.0,
"texture": ExtResource("19_5eqja")
}],
"loop": true,
"name": &"popped",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("11_1jru2")
}],
"loop": true,
"name": &"pressed",
"speed": 5.0
}]

[sub_resource type="AtlasTexture" id="AtlasTexture_e7am8"]
atlas = ExtResource("21_5k6pg")
region = Rect2(0, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_his07"]
atlas = ExtResource("21_5k6pg")
region = Rect2(496, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_4g6dv"]
atlas = ExtResource("21_5k6pg")
region = Rect2(992, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_gbfd5"]
atlas = ExtResource("21_5k6pg")
region = Rect2(1488, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_ukfud"]
atlas = ExtResource("21_5k6pg")
region = Rect2(1984, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_oukks"]
atlas = ExtResource("21_5k6pg")
region = Rect2(2480, 0, 496, 500)

[sub_resource type="AtlasTexture" id="AtlasTexture_3aje1"]
atlas = ExtResource("21_5k6pg")
region = Rect2(0, 0, 496, 500)

[sub_resource type="SpriteFrames" id="SpriteFrames_hgi52"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_e7am8")
}],
"loop": false,
"name": &"angry",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_his07")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4g6dv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gbfd5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ukfud")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_oukks")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3aje1")
}],
"loop": false,
"name": &"attack",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("10_00hlv")
}],
"loop": false,
"name": &"calm",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("14_5oeb3")
}],
"loop": false,
"name": &"dead",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("14_6oneh")
}],
"loop": false,
"name": &"happy",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("15_pve6u")
}],
"loop": false,
"name": &"pressed",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("16_w77yh")
}],
"loop": false,
"name": &"scared",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("17_q3kfc")
}],
"loop": false,
"name": &"super_happy",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("18_4iu74")
}],
"loop": false,
"name": &"worried",
"speed": 5.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_e0h07"]
radius = 114.158

[sub_resource type="CircleShape2D" id="CircleShape2D_cbs37"]
radius = 388.321

[sub_resource type="CircleShape2D" id="CircleShape2D_jkg7u"]
radius = 1319.13

[sub_resource type="Animation" id="Animation_de82r"]
resource_name = "Glance_1"
length = 5.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite/BubbleFaceSprite:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.810202, 1.53309, 1.81393, 2.4637, 2.95271, 3.37066, 3.68201, 3.98564, 5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, 0), Vector2(57.5397, 31.746), Vector2(57.81, 32.061), Vector2(49.6032, 1.98413), Vector2(49.6032, 1.98413), Vector2(-19.8413, 45.6349), Vector2(-19.8413, 45.6349), Vector2(-21.8254, 5.95238), Vector2(0, 0), Vector2(0, 0)]
}

[sub_resource type="Animation" id="Animation_qwgnj"]
resource_name = "Glance_2"
length = 5.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite/BubbleFaceSprite:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.40106, 2.66675, 3.68201, 4.3579, 5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, 0), Vector2(1.98413, -31.746), Vector2(-31.746, -37.6984), Vector2(-21.8254, 5.95238), Vector2(-2.03, 0), Vector2(0, 0)]
}

[sub_resource type="Animation" id="Animation_pqu6g"]
resource_name = "Glance_3"
length = 5.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite/BubbleFaceSprite:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.19124, 2.24711, 3.21499, 3.68201, 3.98564, 5),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector2(0, 0), Vector2(-17.8571, 85.3175), Vector2(39.6825, 101.19), Vector2(47.619, 39.6825), Vector2(-21.8254, 5.95238), Vector2(0, 0), Vector2(0, 0)]
}

[sub_resource type="Animation" id="Animation_wypww"]
resource_name = "Idle_0"
length = 4.0
loop_mode = 1
step = 0.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite/BubbleFaceSprite:scale")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1, 2, 3, 4),
"transitions": PackedFloat32Array(0.63728, 1, 1, 1, 0.965937),
"update": 0,
"values": [Vector2(1, 1), Vector2(1, 0.94), Vector2(1.1, 0.9), Vector2(1.06, 0.95), Vector2(1, 1)]
}

[sub_resource type="Animation" id="Animation_rfgki"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite/BubbleFaceSprite:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("BubbleSprite/BubbleFaceSprite:scale")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("BubbleSprite:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("BubbleSprite:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0.5, 0.5)]
}

[sub_resource type="Animation" id="Animation_4wwkk"]
resource_name = "Rotation"
length = 8.0
loop_mode = 1
step = 0.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite:rotation")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 2, 6, 8),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [0.0, -0.122173, 0.122173, 0.0]
}

[sub_resource type="Animation" id="Animation_q1api"]
resource_name = "Squash"
length = 0.4
loop_mode = 1
step = 0.01
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BubbleSprite:scale")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.13, 0.26, 0.4),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Vector2(0.5, 0.5), Vector2(0.52, 0.48), Vector2(0.48, 0.52), Vector2(0.5, 0.5)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_tvy3c"]
_data = {
"Glance_1": SubResource("Animation_de82r"),
"Glance_2": SubResource("Animation_qwgnj"),
"Glance_3": SubResource("Animation_pqu6g"),
"Idle_0": SubResource("Animation_wypww"),
"RESET": SubResource("Animation_rfgki"),
"Rotation": SubResource("Animation_4wwkk"),
"Squash": SubResource("Animation_q1api")
}

[node name="Bubble" type="CharacterBody2D"]
collision_mask = 10
script = ExtResource("1_udmfy")

[node name="PlayerInteractionStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("1_aabyq")
initial_state = NodePath("UntouchedState")

[node name="UntouchedState" type="Node" parent="PlayerInteractionStateMachine"]
script = ExtResource("9_u1hra")

[node name="PressedState" type="Node" parent="PlayerInteractionStateMachine"]
script = ExtResource("13_0pvk2")

[node name="PoppingState" type="Node" parent="PlayerInteractionStateMachine"]
script = ExtResource("14_kxy2l")

[node name="PoppedState" type="Node" parent="PlayerInteractionStateMachine"]
script = ExtResource("12_0e84d")

[node name="MoodStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("1_aabyq")
initial_state = NodePath("Calm")

[node name="Calm" type="Node" parent="MoodStateMachine"]
script = ExtResource("2_cmhqn")
state_color = Color(1, 1, 1, 1)
corpses_limit = 1

[node name="Happy" type="Node" parent="MoodStateMachine"]
script = ExtResource("3_ql0vy")
state_color = Color(0, 0.654902, 0.215686, 1)
corpses_limit = 2

[node name="LessHappy" type="Node" parent="MoodStateMachine"]
script = ExtResource("4_5o5i0")
state_color = Color(0.729412, 0.729412, 0, 1)
corpses_limit = 4

[node name="Worried" type="Node" parent="MoodStateMachine"]
script = ExtResource("5_8kdti")
state_color = Color(0.870588, 0.619608, 0, 1)
corpses_limit = 5

[node name="Scared" type="Node" parent="MoodStateMachine"]
script = ExtResource("6_8pe0x")
state_color = Color(0.741176, 0.176471, 0, 1)

[node name="RunningAway" type="Node" parent="MoodStateMachine"]
script = ExtResource("12_l4h1j")

[node name="LookingForCompanions" type="Node" parent="MoodStateMachine"]
script = ExtResource("13_36ui5")

[node name="Revolting" type="Node" parent="MoodStateMachine"]
script = ExtResource("14_2j2oh")

[node name="BubbleSprite" type="AnimatedSprite2D" parent="."]
modulate = Color(1, 0.784314, 1, 1)
material = SubResource("ShaderMaterial_m81it")
scale = Vector2(0.5, 0.5)
sprite_frames = SubResource("SpriteFrames_84kn1")
autoplay = "default"
frame_progress = 0.201586
script = ExtResource("9_6kqpo")
max_pupil_distance = 60.0

[node name="BubbleFaceSprite" type="AnimatedSprite2D" parent="BubbleSprite"]
unique_name_in_owner = true
sprite_frames = SubResource("SpriteFrames_hgi52")
animation = &"attack"
frame = 5
frame_progress = 1.0

[node name="CollisionShape2D" type="CollisionShape2D" parent="." groups=["bubbles"]]
shape = SubResource("CircleShape2D_e0h07")
debug_color = Color(0.866667, 0.101961, 0.815686, 0.145098)

[node name="PopWarningArea" type="Area2D" parent="."]
unique_name_in_owner = true
collision_layer = 4
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="PopWarningArea"]
shape = SubResource("CircleShape2D_cbs37")
debug_color = Color(0, 0.6, 0.701961, 0.113725)

[node name="NearbyUnattachedBubbleDetectArea" type="Area2D" parent="."]
unique_name_in_owner = true
collision_layer = 4
collision_mask = 32
monitoring = false
monitorable = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="NearbyUnattachedBubbleDetectArea"]
shape = SubResource("CircleShape2D_jkg7u")

[node name="Timers" type="Node2D" parent="."]

[node name="EscapingTimer" type="Timer" parent="Timers"]
unique_name_in_owner = true
wait_time = 7.0
one_shot = true

[node name="WanderingTimer" type="Timer" parent="Timers"]
unique_name_in_owner = true
wait_time = 5.0

[node name="BodyAnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_tvy3c")
}
autoplay = "Idle_0"

[node name="FaceAnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_tvy3c")
}
autoplay = "Idle_0"

[node name="AttackMarker" parent="." instance=ExtResource("29_og2x4")]
unique_name_in_owner = true

[connection signal="animation_finished" from="BodyAnimationPlayer" to="." method="_on_body_animation_player_animation_finished"]
[connection signal="animation_finished" from="FaceAnimationPlayer" to="." method="_on_face_animation_player_animation_finished"]
